local Package = script.Parent.Parent.Parent.Parent.Parent.Parent

local LuauCeption = require(Package.Vendor.LuauCeption)

local VMBindings = require(Package.Client.Singletons.VM.Bindings)
local VMEnvironment = require(Package.Client.Singletons.VM.Environment)
local VMTypes = require(Package.Client.Singletons.VM.Types)

local Network = require(Package.Client.Network)

local cFunctions = LuauCeption.wasm.cfns

local function getAsync(luaState: VMTypes.LuaState)
	local url = VMBindings:ToLuau(luaState, 2)
	local response = Network.HttpGetRequest.Call(url)

	VMBindings:FromLuau(luaState, response)

	return 1
end

return function()
	local __namecall
	
	__namecall = VMEnvironment:Hook("__namecall", function(luaState: VMTypes.LuaState)
		local methodName = VMBindings:ReadCString(cFunctions.lua_namecallatom(luaState, 0))
		local object = VMBindings:ToLuau(luaState, 1)

		if object == game and methodName == "HttpGetAsync" then
			return getAsync(luaState)
		end

		return __namecall(luaState)
	end)
end
